{% assign post=include.post %}

{% assign class = "" %}
{% assign href = "#" %}
{% if post.url != page.url %}
	{% assign class="isnav" %}
	{% assign href = post.url %}
{% endif %}

<article class="blogpost">
	<h2 id="{{ post.id }}"><a href="{{ href }}" class="{{ class }}">{{ post.title }}</a></h2>

	{% if include.truncate != nil %}
		{{ post.content | truncate: include.truncate }}
	{% else %}
		{% capture content %}
		{{ post.content }}
		{% endcapture %}
		
		<!-- Replace all heading starts with ones that end and start section tags -->
		{% assign content = content | replace: "<h3", "</section><section><h3" | lstrip %}
		
		<!-- If starts with a </section>, delete it, it's unnecessary -->
		{% assign start = content | slice: 0, 10 %}
		{% if start == "</section>" %}
			{% assign content = content | slice: 10, content.size %}
		{% endif %}
		
		{%- for i in (0..content.size) -%}
			{%- assign substring = content | slice: i, 9 -%}
			{%- if substring == "<section>" -%}
				{%- break -%}
			{%- endif -%}
			{%- if substring == "</section" -%}
				{%- assign content = "<section>" | append: content -%}
				{%- break -%}
			{%- endif -%}
		{%- endfor -%}
		
		{{ content | lstrip }}
		{% if content contains "<section>" %}
			</section>
		{% endif %}
	{% endif %}

	<footer>
		<p class="details">
			Posted <span class="date"><span data-date="{{ post.date }}">{{ post.date | date: "%b %d, %Y" }}</span></span>
			<br>
			{% if post.tags.size %}
				Tagged as 
					{% assign tags = post.tags | sort %}
					{% for tag in tags %}
						<span class="tag">{{ tag }}</span>
					{% endfor %}
			{% endif %}
		</p>
		{% if include.truncate != nil %}
			<a class="local-link" href="{{ href }}">Read More</a>
		{% endif %}
	</footer>
</article>